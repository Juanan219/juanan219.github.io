<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:Juan Antonio Reifs]">
<meta name="description" content="Hasta ahora hemos usado imágenes de Docker que han hecho otras personas, pero para crear un contenedor que sirva nuestra aplicación, deberemos crear una imagen personalidada. A esto es a lo que llamamos dockerizar una aplicación.
Creación de una imagen a partir de un contenedor La primera forma de crear nuestras propias imágenes personalizadas es crearlas a partir de un contenedor que ya está en ejecución. Para ello tenemos varias posibilidades:" />
<meta name="keywords" content=", Apuntes, Documentacion, Docker, DockerHub, GitHub, Imagenes, Linux, DockeBuild, Dockerfile" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://juanan219.github.io/posts/2021/02/creaci%C3%B3n-de-imagenes-docker/" />


    <title>
        
            Creación de Imagenes Docker :: JuananBlog  — JuananBlog
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://juanan219.github.io/main.154a87e0ff720e102948892a8eb80881aa81a4faf37376f3093be219f6296c3d.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://juanan219.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://juanan219.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://juanan219.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://juanan219.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://juanan219.github.io/safari-pinned-tab.svg" color="#1b1c1d">
    <link rel="shortcut icon" href="https://juanan219.github.io/favicon.ico">
    <meta name="msapplication-TileColor" content="#1b1c1d">
    <meta name="theme-color" content="#1b1c1d">



<meta itemprop="name" content="Creación de Imagenes Docker">
<meta itemprop="description" content="Hasta ahora hemos usado imágenes de Docker que han hecho otras personas, pero para crear un contenedor que sirva nuestra aplicación, deberemos crear una imagen personalidada. A esto es a lo que llamamos dockerizar una aplicación.
Creación de una imagen a partir de un contenedor La primera forma de crear nuestras propias imágenes personalizadas es crearlas a partir de un contenedor que ya está en ejecución. Para ello tenemos varias posibilidades:">
<meta itemprop="datePublished" content="2021-02-24T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-02-24T00:00:00+00:00" />
<meta itemprop="wordCount" content="1958">
<meta itemprop="image" content="https://juanan219.github.io"/>



<meta itemprop="keywords" content="Apuntes,Documentacion,Docker,DockerHub,GitHub,Imagenes,Linux,DockeBuild,Dockerfile," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://juanan219.github.io"/>

<meta name="twitter:title" content="Creación de Imagenes Docker"/>
<meta name="twitter:description" content="Hasta ahora hemos usado imágenes de Docker que han hecho otras personas, pero para crear un contenedor que sirva nuestra aplicación, deberemos crear una imagen personalidada. A esto es a lo que llamamos dockerizar una aplicación.
Creación de una imagen a partir de un contenedor La primera forma de crear nuestras propias imágenes personalizadas es crearlas a partir de un contenedor que ya está en ejecución. Para ello tenemos varias posibilidades:"/>




    <meta property="og:title" content="Creación de Imagenes Docker" />
<meta property="og:description" content="Hasta ahora hemos usado imágenes de Docker que han hecho otras personas, pero para crear un contenedor que sirva nuestra aplicación, deberemos crear una imagen personalidada. A esto es a lo que llamamos dockerizar una aplicación.
Creación de una imagen a partir de un contenedor La primera forma de crear nuestras propias imágenes personalizadas es crearlas a partir de un contenedor que ya está en ejecución. Para ello tenemos varias posibilidades:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://juanan219.github.io/posts/2021/02/creaci%C3%B3n-de-imagenes-docker/" />
<meta property="og:image" content="https://juanan219.github.io"/>
<meta property="article:published_time" content="2021-02-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-02-24T00:00:00+00:00" />







    <meta property="article:published_time" content="2021-02-24 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://juanan219.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://juanan219.github.io/about/">About</a></li><li><a href="https://juanan219.github.io/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        10 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://juanan219.github.io/posts/2021/02/creaci%C3%B3n-de-imagenes-docker/">Creación de Imagenes Docker</a>
      </h1>

      

      

      <div class="post-content">
        <p>Hasta ahora hemos usado imágenes de Docker que han hecho otras personas, pero para crear un contenedor que sirva nuestra aplicación, deberemos crear una imagen personalidada. A esto es a lo que llamamos <em>dockerizar</em> una aplicación.</p>
<p><img src="https://juanan219.github.io/Docker/Documentacion/19.png" alt="Captura 19"></p>
<h2 id="creación-de-una-imagen-a-partir-de-un-contenedor">Creación de una imagen a partir de un contenedor</h2>
<p>La primera forma de crear nuestras propias imágenes personalizadas es <strong>crearlas a partir de un contenedor</strong> que ya está en ejecución. Para ello tenemos varias posibilidades:</p>
<ol>
<li>
<p>Usar la secuencia de órdenes <code>docker commit</code> / <code>docker save</code> / <code>docker load</code>. En este caso, la distribución se producirá a partir de un fichero.</p>
</li>
<li>
<p>Utilizar la pareja de órdenes <code>docker commit</code> / <code>docker push</code>. En este caso, la distribución se producirá a partir de <strong>DockerHub</strong></p>
</li>
<li>
<p>Utilizar la pareja de órdenes <code>docker export</code> / <code>docker import</code>. En este caso, la distribución se producirá a partir de un fichero.</p>
</li>
</ol>
<p>Nosotros veremos las dos primeras formas de crear una imagen a partir de un contenedor, ya que la tercera forma se limita a copiar el sistema de archivos sin tener en cuenta la información de las imágenes de las que deriva el contenedor y, además, si tenemos algún volumen montado, esta opción lo obviará.</p>
<h3 id="distribución-a-partir-de-un-fichero">Distribución a partir de un fichero</h3>
<ol>
<li>Arranca un contenedor a partir de una imagen base</li>
</ol>
<pre><code>docker run -it --name docker_debian debian bash
</code></pre><ol start="2">
<li>Realiza modificaciones en el contenedor</li>
</ol>
<pre><code>root@b3bcf59aefc2:/# apt-get update &amp;&amp; apt-get install -y apache2
</code></pre><ol start="3">
<li>Crear una nueva imagen partiendo de ese contenedor usando <code>docker commit</code>. Con esta instrucción se creará una nueva imagen con las capas de la imagen base mas la capa propia del contenedor. Al creala no voy a poner etiqueta, por lo que será latest.</li>
</ol>
<pre><code>docker commit docker_debian juanan219/debian_prueba
sha256:fc7791340642d790bf921715c445c20b5ddfc6863d7e47ba98d7a1c73d462d1c

docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
juanan219/debian_prueba       latest              fc7791340642        14 seconds ago      243MB
[...]
</code></pre><ol start="4">
<li>Guardar esa imagen en un archivo <code>.tar</code> usando el comando <code>docker save</code>:</li>
</ol>
<pre><code>docker save juanan219/debian_prueba &gt; debian_prueba.tar

ls
debian_prueba.tar
</code></pre><ol start="5">
<li>
<p>Distribuir el archivo <code>.tar</code></p>
</li>
<li>
<p>Si me llega un fichero <code>.tar</code> puedo añadir la imagen a mi repositorio local</p>
</li>
</ol>
<pre><code>docker rmi juanan219/debian_prueba
Untagged: juanan219/debian_prueba:latest
Deleted: sha256:fc7791340642d790bf921715c445c20b5ddfc6863d7e47ba98d7a1c73d462d1c
Deleted: sha256:ffc144c3004d5f83465eb03998204ca52530598d6388c65367484e33523991fd

docker load -i debian_prueba.tar 
b124061f7913: Loading layer [==================================================&gt;]  132.4MB/132.4MB
Loaded image: juanan219/debian_prueba:latest
</code></pre><h3 id="distribución-usando-dockerhub">Distribución usando DockerHub</h3>
<ol>
<li>Arranca un contenedor a partir de una imagen base</li>
</ol>
<pre><code>docker run -it --name debian_prueba debian bash
</code></pre><ol start="2">
<li>Realiza modificaciones en el contenedor</li>
</ol>
<pre><code>root@b3bcf59aefc2:/# apt-get update &amp;&amp; apt-get install -y apache2
</code></pre><ol start="3">
<li>Crear una nueva imagen partiendo de ese contenedor usando <code>docker commit</code>. Con esta instrucción se creará una nueva imagen con las capas de la imagen base mas la capa propia del contenedor. Al creala no voy a poner etiqueta, por lo que será latest.</li>
</ol>
<pre><code>docker commit debian_prueba juanan219/debian_prueba
sha256:fc7791340642d790bf921715c445c20b5ddfc6863d7e47ba98d7a1c73d462d1c

docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
juanan219/debian_prueba       latest              fc7791340642        28 seconds ago      243MB
[...]
</code></pre><ol start="4">
<li>Autentificarme en Docker Hub usando el comando <code>docker login</code>.</li>
</ol>
<pre><code>docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: juanan219
Password: 
Login Succeeded
</code></pre><ol start="5">
<li>Distribuir ese fichero subiendo la nueva imagen a DockerHub mediante <code>docker push</code>.</li>
</ol>
<pre><code>docker push juanan219/debian_prueba
The push refers to repository [docker.io/juanan219/debian_prueba]
fd7d86e14e9c: Pushed 
7f03bfe4d6dc: Mounted from jenkins/jenkins 
latest: digest: sha256:29ca12fb2ecadeff4625d4cbea5a3aba92782f8b0702329e8b90134f3bde832d size: 741
</code></pre><p>Después de realizar esto, cualquier puede descargarse nuestra imagen tanto utilizándola como usando el comando <code>docker pull</code>.</p>
<h2 id="creación-de-imágenes-con-fichero-dockerfile">Creación de imágenes con fichero dockerfile</h2>
<p>Crear imágenes a partir de contenedores ya creados tiene dos inconvenientes.</p>
<ul>
<li>
<p><strong>No se puede reproducir la imagen</strong>, es decir, que si la perdemos tenemos que recordar toda la secuencia de órdenes que habíamos realizado desde que arrancamos el contenedor hasta que teníamos una versión definitiva e hicimos el <code>docker commit</code></p>
</li>
<li>
<p><strong>No podemos cambiar la imagen de base</strong>, es decir, que si ha habido alguna actualización, problemas de seguridad o algo por el estilo con la imagen base, tenemos que descargar la nueva versión, volver a crear un nuevo contenedor basado en ella y volver a ejecutar de nuevo toda la secuencia de órdenes.</p>
</li>
</ul>
<p>Por estos dos problemas, el método preferido para crear imágenes es el uso del llamado <code>dockerfile</code> y el comando <code>docker build</code>. Estos son los pasos fundamentales:</p>
<ol>
<li>
<p>Crear el fichero <code>dockerfile</code>.</p>
</li>
<li>
<p>Construir la imagen usando la definición guardada en el fichero <code>dockerfile</code> y el comando <code>docker build</code>.</p>
</li>
<li>
<p>Autentificarme en DockerHub usando el comando <code>docker login</code>.</p>
</li>
<li>
<p>Distribuir ese fichero subiendo la nueva imagen a DockerHub mediante el comando <code>docker push</code>.</p>
</li>
</ol>
<p>Con este método podemos tener ciertas ventajas:</p>
<ul>
<li>
<p><strong>Reproducir la imagen fácilmente</strong> ya que en el fichero <code>dockerfile</code> tenemos todas las instrucciones necesarias para la construcción de la imagen. Si además tenemos el <code>dockerfile</code> en un repositorio con control de versiones como <code>git</code>, podemos además asociar los cambios en el <code>dockerfile</code> a los cambios de versiones de las imágenes creadas.</p>
</li>
<li>
<p>Si queremos cambiar la imagen de base, esto es muy sencillo con el fichero <code>dockerfile</code>, ya que simplemente deberemos modificar la primera línea del fichero, como explicaremos posteriormente.</p>
</li>
</ul>
<h3 id="el-fichero-dockerfile">El fichero Dockerfile</h3>
<p>El fichero <code>dockerfile</code> es un conjunto de instrucciones que se irán ejecutando secuencialmente para construir una nueva imagen Docker. Cada una de las instrucciones que ejecutemos, creará una nueva capa en la imagen que estamos creando.</p>
<p>Hay varias instrucciones que podemos usar en la construcción de un <code>dockerfile</code>, pero la estructura fundamental de este fichero es:</p>
<ul>
<li>
<p><strong><code>FROM</code>:</strong> Aquí indicamos la imagen base</p>
</li>
<li>
<p><strong><code>MANTEINER, LABEL</code>:</strong> Metadatos</p>
</li>
<li>
<p><strong><code>RUN, COPY, ADD, WORKDIR</code>:</strong> Instrucciones de construcción</p>
</li>
<li>
<p><strong><code>USER, EXPOSE, ENV</code>:</strong> Configuración (Variables de entorno, usuarios, puertos)</p>
</li>
<li>
<p><strong><code>CMD, ENTRYPOINT</code>:</strong> Instrucciones de arranque</p>
</li>
</ul>
<p>Vamos a ver las principales instrucciones que podemos usar:</p>
<ul>
<li><strong><code>FROM</code>:</strong> Sirve para especificar la imagen sobre la que voy a construir la mía.</li>
</ul>
<pre><code>FROM: php:7.4-apache
</code></pre><ul>
<li><strong><code>LABEL</code>:</strong> Sirve para añadir metadatos a la imagen clave.</li>
</ul>
<pre><code>LABEL company=iesgn
</code></pre><ul>
<li><strong><code>COPY</code>:</strong> Sirve para copiar fichero desde mi equipo hacia la imagen. Esos ficheros deben de estar en la misma carpeta o repositorio. La sintáxis de <code>COPY</code> es:</li>
</ul>
<pre><code>COPY [--chown=&lt;usuario&gt;:&lt;grupo&gt;] src dest
</code></pre><pre><code>* Ejemplo de `COPY`:
</code></pre>
<pre><code>COPY --chown=www-data:www-data wordpress/wp /var/www/html
</code></pre><ul>
<li>
<p><strong><code>ADD</code>:</strong> Es similar a <code>COPY</code> pero tiene funcionalidades adicionales, como especificar URLs y tratar archivos comprimidos.</p>
</li>
<li>
<p><strong><code>RUN</code>:</strong> Ejecuta una orden creando una nueva capa. La sintáxis de <code>RUN</code> es:</p>
</li>
</ul>
<pre><code>RUN orden

RUN [&quot;orden&quot;,&quot;parámetro 1&quot;, &quot;parámetro 2&quot;]
</code></pre><pre><code>* Ejemplo de `RUN`:
</code></pre>
<pre><code>RUN apt-get update &amp;&amp; apt-get install -y git
</code></pre><blockquote>
<p>En este caso, es muy importante ejecutar el comando de instalación de <code>git</code> con la opción <code>-y</code>, ya que en el proceso de creación de la imagen con el <code>dockerfile</code> no puede haber interacción con el usuario.</p>
</blockquote>
<ul>
<li><strong><code>WORKDIR</code>:</strong> Establece el directorio de trabajo dentro de la imagen que estoy creando, para posteriormente usar las órdenes <code>RUN</code>, <code>COPY</code>, <code>ADD</code>, <code>CMD</code> o <code>ENTRYPOINT</code>.</li>
</ul>
<pre><code>WORKDIR /usr/local/apache/htdocs
</code></pre><ul>
<li><strong><code>EXPOSE</code>:</strong> Nos da información sobre qué puertos tendrá abiertos el contenedor cuando se cree uno en base a la imagen que estamos creando. Es meramente informativo.</li>
</ul>
<pre><code>EXPOSE 80
</code></pre><ul>
<li><strong><code>USER</code>:</strong> Para especificar meidante nombre o <code>UID</code>/<code>GID</code> el usuario de trabajo para todas las órdenes <code>RUN</code>, <code>CMD</code> y <code>ENTRYPOINT</code> posteriores.</li>
</ul>
<pre><code>USER jenkins

USER 10001:10001
</code></pre><ul>
<li><strong><code>ARG</code>:</strong> Define variables para las cuales los usuarios pueden especificar valores a la hora de hacer el proceso de <code>build</code> mediante la opción <code>--build-arg</code>. Su sintáxis es:</li>
</ul>
<pre><code>ARG nombre_variable

ARG nombre_variable=valor_por_defecto
</code></pre><pre><code>* Ejemplo de `ARG`:
</code></pre>
<pre><code>ARG usuario=www-data
</code></pre><blockquote>
<p>No se puede usar ni en <code>ENTRYPOINT</code> ni en <code>CMD</code></p>
</blockquote>
<ul>
<li><strong><code>ENV</code>:</strong> Para establecer variables de entorno dentro del contenedor. Puede ser usado posteriormente en las opciones <code>RUN</code> añadiendo <code>$</code> delante del nombre de la variable de entorno.</li>
</ul>
<pre><code>ENV WEB_DOCUMENT_ROOT=/var/www/html
</code></pre><blockquote>
<p>No se puede usar ni en <code>ENTRYPOINT</code> ni en <code>CMD</code></p>
</blockquote>
<ul>
<li><strong><code>ENTRYPOINT</code>:</strong> sirve para establecer el ejecutable que se lanza siempre que se crea un contenedor con <code>docker run</code>, salvo que se especifique algo con la opción <code>--entrypoint</code>. La sintáxis de <code>ENTRYPOINT</code> es:</li>
</ul>
<pre><code>ENTRYPOINT &lt;comando&gt;

ENTRYPOINT [&quot;ejecutable&quot;, &quot;parámetro 1&quot;, &quot;parámetro 2&quot;]
</code></pre><pre><code>* Ejemplo de `ENTRYPOINT`:
</code></pre>
<pre><code>ENTRYPOINT [&quot;/usr/sbin/apache2ctl&quot;, &quot;-D&quot;, &quot;FOREGROUND&quot;]
</code></pre><ul>
<li><strong><code>CMD</code>:</strong> Sirve para establecer un ejecutable por defecto (salvo que se sobreescriba desde la orden <code>docker run</code>) o para especificar parámetros para un <code>ENTRYPOINT</code>. Si tengo varios, sólo se ejecuta el último. La sintáxis de <code>CMD</code> es:</li>
</ul>
<pre><code>CMD parámetro1 parámetro2

CMD [&quot;parámetro 1&quot;,&quot;parámetro 2&quot;]

CMD [&quot;comando&quot;,&quot;parámetro 1&quot;]
</code></pre><pre><code>* Ejemplo de `CMD`:
</code></pre>
<pre><code>CMD [&quot;-c&quot;,&quot;/etc/nginx.conf&quot;]

ENTRYPOINT [&quot;nginx&quot;]
</code></pre><ul>
<li>
<p><strong>Ejemplo:</strong></p>
<ul>
<li>Si tenemos un fichero <code>dockerfile</code> que tiene las siguientes instrucciones</li>
</ul>
</li>
</ul>
<pre><code>ENTRYPOINT [&quot;http&quot;, &quot;-v&quot;]

CMD [&quot;-p&quot;, &quot;80&quot;]
</code></pre><pre><code>* Podemos crear un contenedor a partir de la imagen generada:

    * `docker run centos:centos7`: Se creará un contenedor con el servidor web escuchando en el puerto `80`.

    * `docker run centos:centos7 -p 8080`: Se creará un contenedor con el servidor web escuchando en el puerto `8080`
</code></pre>
<h3 id="construyendo-imágenes-con-docker-build">Construyendo imágenes con docker build</h3>
<p>El comando <code>docker build</code> construye las imágenes leyendo las instrucciones del <code>dockerfile</code> y la información de un entorno, que para nosotros va a ser un directorio (aunque también podemos gestionar la información de un repositorio <code>git</code>).</p>
<p>A la hora de crear una imagen, tenemos que tener en cuenta que cada vez que se ejecuta una instrucción se genera una imagen intermedia. Algunas imágenes intermedias se guardan en caché, otras se borran. Por lo tanto, si ejecutamos en una línea el comando <code>cd scripts/</code> y en otra línea ejecutamos <code>./install.sh</code>, no va a funcionar, ya que se ha lanzado otra imágen intermedia. Teniendo esto en cuenta, la manera correcta de ejecutar esto sería:</p>
<pre><code>cd scripts/;./install.sh
</code></pre><p>Al generar las imágenes con <code>dockerfile</code>, como hemos dicho anteriormente, las imágenes se guardan temporalmente en caché, esto quiere decir que si en el proceso de creación de la imagen ha fallado algún paso, al corregirlo y volver a intentarlo, los pasos que han salido bien no se vuelven a repetir, ya que esas imágenes intermedias están almacenadas en la caché.</p>
<h3 id="ejemplo-de-dockerfile">Ejemplo de Dockerfile</h3>
<p>Vamos a crear un directorio (el cual va a ser nuestro entorno de creación de la imagen) donde vamos a crear un <code>dockerfile</code> y un fichero <code>index.html</code>.</p>
<pre><code>mkdir pruebas_docker
cd pruebas_docker/

echo &quot;&lt;h1&gt;Esto es una prueba de Dockerfile&lt;/h1&gt;&quot; &gt; index.html

nano Dockerfile

FROM debian 
MAINTAINER Juan Antonio Reifs Ramirez &quot;initiategnat9@gmail.com&quot;
RUN apt update  &amp;&amp; apt install -y  apache2 
COPY index.html /var/www/html/index.html
ENTRYPOINT [&quot;/usr/sbin/apache2ctl&quot;, &quot;-D&quot;, &quot;FOREGROUND&quot;]

ls
Dockerfile  index.html
</code></pre><p>Cuando tenemos creado y escritas las instrucciones en nuestro fichero <code>Dockerfile</code> y nuestro <code>index.html</code> creado vamos a generar la imagen con <code>docker build</code> indicando el nombre de la nueva imagen con la opción <code>-t</code> e indicando el directorio de contexto.</p>
<pre><code>docker build -t juanan219/prueba_dockerfile .
</code></pre><p>Cuando haya terminado el proceso de generación de nuestra primera imagen, podemos verla en nuestro repositorio local</p>
<pre><code>docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
juanan219/prueba_dockerfile   latest              67196e6920a2        53 seconds ago      243MB
[...]
</code></pre><p>Después de realizar esto, ya podemos usar la imágen como otra cualquier, a parte de poder distribuirla.</p>
<blockquote>
<p>Si usamos la opción <code>--no-cache</code> en el comando <code>docker-build</code> haríamos la construcción de la imagen sin usar las capas cacheadas.</p>
</blockquote>
<h3 id="buenas-prácticas-al-crear-un-dockerfile">Buenas prácticas al crear un Dockerfile</h3>
<ul>
<li>
<p><strong>Los contenedores deben ser efímeros:</strong> esto quiere decir que los contenedores que se creen con nuestra imagen deben tener una mímina configuración.</p>
</li>
<li>
<p><strong>Uso de ficheros <code>.dockerignore</code>:</strong> Como hemos dicho anteriormente, todos los ficheros del contexto se envían al <code>docker engine</code>, por ello es recomendable usar un directorio/repositorio vacío en el cual vamos creando los fichero que vamos a ir necesitando. Además, para aumentar el rendimiento y evitar enviar ficheros innecesarios al daemon podemos usar un fichero <code>.dockerignore</code> para excluir ficheros y directorios.</p>
</li>
<li>
<p><strong>No instalar paquetes innecesarios:</strong> Para reducir la complejidad, dependencias, tiempo de creación y tamaño de la imagen resultante, se debe evitar instalar pequetes extras o innecesarios. Si necesitamos algún paquete durante la creación de la imagen, lomejor es desinstalarlo durante el proceso.</p>
</li>
<li>
<p><strong>Minimizar el número de capas:</strong> Debemos encontrar el balance entre la legibilidad del <code>Dockerfile</code> y minimizar el número de capas que utiliza.</p>
</li>
<li>
<p><strong>Indicar las instrucciones a ejecutar múltiples tareas:</strong> Hay que organizar los argumentos de las instrucciones que contengan múltiples línes para facilitar futuros cambios. Esto evitará la duplicación de paquetes y hará que el archivo sea más fácil de leer. Por ejemplo:</p>
</li>
</ul>
<pre><code>RUN apt-get update &amp;&amp; apt-get install -y \
git \
wget \
apache2 \
php5
</code></pre>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://juanan219.github.io/tags/apuntes/">Apuntes</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/documentacion/">Documentacion</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/docker/">Docker</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/dockerhub/">DockerHub</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/github/">GitHub</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/imagenes/">Imagenes</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/linux/">Linux</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/dockebuild/">DockeBuild</a></span>
        <span class="tag"><a href="https://juanan219.github.io/tags/dockerfile/">Dockerfile</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1958 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          24242-24-00 22:10
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;caption=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;canonicalUrl=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;body=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f&amp;media=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f;description=Creaci%c3%b3n%20de%20Imagenes%20Docker" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f&amp;title=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;summary=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;source=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f&amp;resubmit=true&amp;title=Creaci%c3%b3n%20de%20Imagenes%20Docker" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f;title=Creaci%c3%b3n%20de%20Imagenes%20Docker" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Creaci%c3%b3n%20de%20Imagenes%20Docker%20https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f&amp;t=Creaci%c3%b3n%20de%20Imagenes%20Docker" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Creaci%c3%b3n%20de%20Imagenes%20Docker&amp;url=https%3a%2f%2fjuanan219.github.io%2fposts%2f2021%2f02%2fcreaci%25C3%25B3n-de-imagenes-docker%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://juanan219.github.io/posts/2021/03/implantaci%C3%B3n-de-aplicaciones-web-php-en-docker/">
                <span class="button__icon">←</span>
                <span class="button__text">Implantación de aplicaciones web PHP en Docker</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="https://juanan219.github.io/posts/2021/02/almacenamiento-en-docker/">
                <span class="button__text">Almacenamiento en Docker</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://juanan219.github.io">Juan antonio Reifs</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="https://juanan219.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="https://juanan219.github.io/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js" integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj&#43;AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script>



    </body>
</html>
